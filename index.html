<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ğŸ Enrollment Race to 550</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
html,body{margin:0;overflow-x:hidden;font-family:Arial,sans-serif}

body{
  background:repeating-linear-gradient(90deg,#86efac 0 60px,#a7f3d0 60px 120px);
  padding:60px 12px 80px;
  text-align:center;
}

h1{color:#ef4444;font-size:36px;margin-bottom:14px}

.buttons button{
  padding:8px 14px;
  border:none;
  border-radius:20px;
  margin:4px;
  cursor:pointer;
}
.buttons .active{background:#22c55e;color:#fff}

#dashboard{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
  gap:14px;
  max-width:1200px;
  margin:0 auto;
}

.card{
  background:#fff;
  padding:18px;
  border-radius:24px;
  box-shadow:0 10px 28px rgba(0,0,0,.15);
}

.progress{height:16px;background:#e5e7eb;border-radius:12px;overflow:hidden;margin:10px 0}
.bar{height:100%;background:#22c55e;transition:width .6s}

.badge{
  margin-top:6px;
  padding:4px 10px;
  border-radius:12px;
  font-size:12px;
  display:inline-block;
}
.mvp{background:gold}
.defending{background:#fde047}
.runner{background:silver}
.third{background:#cd7f32}

#goalBox{
  background:#fff;
  padding:18px;
  border-radius:26px;
  max-width:900px;
  margin:20px auto;
}

#managersHeader{
  position:sticky;
  top:0;
  background:#fff;
  padding:12px;
  border-radius:20px;
  font-size:20px;
  margin:24px auto 10px;
  max-width:900px;
}

#podium{
  display:flex;
  justify-content:center;
  gap:16px;
  margin-top:16px;
}
.podium{
  background:#fff;
  padding:14px;
  border-radius:18px;
  min-width:120px;
  animation:pop .6s ease;
}
@keyframes pop{
  from{opacity:0;transform:translateY(10px) scale(.95)}
  to{opacity:1;transform:none}
}
</style>
</head>

<body>

<h1>ğŸ Enrollment Race to 550</h1>

<div class="buttons">
  <button onclick="setView('ytd',this)">Year to Date</button>
  <button class="active" onclick="setView('month',this)">This Month</button>
  <button onclick="setView('week',this)">This Week</button>
</div>

<div id="goalBox">
  <h3>ğŸ Team Goal</h3>
  <div class="progress"><div id="goalBar" class="bar"></div></div>
  <p id="goalText">0 / 550 (0%)</p>
</div>

<div id="dashboard"></div>

<div id="managersHeader">â­ Managers</div>

<div id="podium"></div>

<script>
/* ================= CSV LINKS (ONLY 2) ================= */
const WEEKLY_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTDtYk0GQ5RzrRT_SBmcjH1TfE3k_kHJ5Sd7nmnoKr81UiDPHXF42gd46qCAuAW5hpwjdKC-6-P8bji/pub?gid=0&single=true&output=csv";
const YEARLY_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTDtYk0GQ5RzrRT_SBmcjH1TfE3k_kHJ5Sd7nmnoKr81UiDPHXF42gd46qCAuAW5hpwjdKC-6-P8bji/pub?gid=1984389436&single=true&output=csv";

let currentView="month";
let lastMVP=localStorage.getItem("lastMVP")||null;

/* ================= VIEW ================= */
function setView(v,btn){
  currentView=v;
  document.querySelectorAll(".buttons button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  loadData();
}

/* ================= LOAD ================= */
async function loadData(){
  if(currentView==="ytd"){
    loadYearly();
  }else{
    loadWeekly();
  }
}

/* ================= YEARLY ================= */
async function loadYearly(){
  const res=await fetch(YEARLY_CSV);
  const txt=await res.text();
  const rows=txt.split("\n").slice(1);

  const data={};
  rows.forEach(r=>{
    const [name,val]=r.split(",");
    data[name]=(Number(val)||0);
  });

  render(Object.entries(data));
}

/* ================= WEEK / MONTH ================= */
async function loadWeekly(){
  const res=await fetch(WEEKLY_CSV);
  const txt=await res.text();
  const rows=txt.split("\n").slice(1);

  const now=new Date();
  const data={};

  rows.forEach(r=>{
    const [date,name,val]=r.split(",");
    if(!date||!name) return;

    const d=new Date(date);
    if(currentView==="week"){
      const diff=(now-d)/(1000*60*60*24);
      if(diff>6) return;
    }
    if(currentView==="month"){
      if(d.getMonth()!==now.getMonth()||d.getFullYear()!==now.getFullYear()) return;
    }

    data[name]=(data[name]||0)+(Number(val)||0);
  });

  render(Object.entries(data));
}

/* ================= RENDER ================= */
function render(entries){
  entries.sort((a,b)=>b[1]-a[1]);
  const dash=document.getElementById("dashboard");
  const podium=document.getElementById("podium");
  dash.innerHTML="";podium.innerHTML="";

  let total=0;
  entries.forEach(e=>total+=e[1]);

  entries.forEach(([name,val],i)=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<h4>${name}</h4><p>${val}</p>`;

    if(i===0 && val>0){
      c.innerHTML+=`<div class="badge mvp">ğŸ† MVP</div>`;
      if(lastMVP===name) c.innerHTML+=`<div class="badge defending">ğŸ‘‘ Defending MVP</div>`;
      localStorage.setItem("lastMVP",name);
    }
    if(i===1) c.innerHTML+=`<div class="badge runner">ğŸ¥ˆ Runner-Up</div>`;
    if(i===2) c.innerHTML+=`<div class="badge third">ğŸ¥‰ 3rd Place</div>`;

    dash.appendChild(c);
  });

  entries.slice(0,3).forEach((e,i)=>{
    const p=document.createElement("div");
    p.className="podium";
    p.innerHTML=`${["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"][i]}<br>${e[0]}<br>${e[1]}`;
    podium.appendChild(p);
  });

  const pct=Math.min(100,Math.round(total/550*100));
  document.getElementById("goalBar").style.width=pct+"%";
  document.getElementById("goalText").innerText=`${total} / 550 (${pct}%)`;

  if([25,50,75,100].includes(pct)){
    confetti({particleCount:120,spread:80,origin:{y:.6}});
  }
}

loadData();
</script>

</body>
</html>
