<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>üèÅ Enrollment Race to 550</title>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
/* ================= CARTOON RACETRACK BACKGROUND ================= */
body{
  font-family:Arial,sans-serif;
  color:#fff;
  text-align:center;
  padding:30px;

  background:
    repeating-linear-gradient(
      90deg,#fff 0 10px,transparent 10px 20px
    ) top/100% 14px no-repeat,

    linear-gradient(
      90deg,transparent 48%,#facc15 48%,#facc15 52%,transparent 52%
    ),

    repeating-linear-gradient(
      90deg,transparent,transparent 45px,
      rgba(255,255,255,.15) 45px,
      rgba(255,255,255,.15) 50px
    ),

    linear-gradient(135deg,#0f172a,#020617);

  background-size:
    100% 14px,
    100% 100%,
    120px 100%,
    cover;
}

/* ================= BUTTONS ================= */
.buttons button{
  margin:6px;
  padding:10px 18px;
  border-radius:14px;
  border:none;
  font-weight:bold;
  cursor:pointer;
}

/* ================= CARDS ================= */
.card{
  background:rgba(30,41,59,.95);
  max-width:360px;
  margin:18px auto;
  padding:20px;
  border-radius:20px;
  box-shadow:0 14px 35px rgba(0,0,0,.55);
  cursor:pointer;
}

/* ================= PROGRESS ================= */
.progress{
  background:#334155;
  height:22px;
  border-radius:14px;
  overflow:hidden;
  margin:12px 0;
}

.bar{
  height:100%;
  position:relative;
  transition:width .6s ease;
  background:linear-gradient(90deg,#facc15,#22c55e);
}

.bar::after{
  content:"üèéÔ∏èüí®";
  position:absolute;
  right:-10px;
  top:-18px;
  font-size:22px;
}

/* ================= MVP ================= */
#mvp{
  position:fixed;
  top:18px;
  left:18px;
  background:#fff7ed;
  color:#000;
  border:5px solid #f59e0b;
  border-radius:22px;
  padding:20px 26px;
  min-width:220px;
  box-shadow:
    0 0 22px rgba(245,158,11,.9),
    0 12px 28px rgba(0,0,0,.25);
  animation:pulse 2s infinite;
  text-align:left;
  z-index:999;
}

#mvp strong{
  display:block;
  font-size:20px;
}

@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.05)}
  100%{transform:scale(1)}
}

/* ================= MODAL ================= */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  align-items:center;
  justify-content:center;
}

.modal-content{
  background:#0f172a;
  padding:22px;
  border-radius:16px;
  max-width:420px;
}

.close{cursor:pointer;}
</style>
</head>

<body>

<h1>üèÅ Enrollment Race to 550</h1>

<div class="buttons">
  <button onclick="setView('ytd')">Year to Date</button>
  <button onclick="setView('month')">This Month</button>
  <button onclick="setView('week')">This Week</button>
</div>

<div id="mvp"></div>
<div id="team"></div>
<div id="dashboard"></div>

<div class="modal" id="popup">
  <div class="modal-content">
    <span class="close" onclick="closePopup()">‚úñ</span>
    <div id="popupContent"></div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const TEAM_GOAL = 550;

/* üî¥ YOUR LIVE GOOGLE SHEETS (UNCHANGED) */
const YEARLY_CSV =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTDtYk0GQ5RzrRT_SBmcjH1TfE3k_kHJ5Sd7nmnoKr81UiDPHXF42gd46qCAuAW5hpwjdKC-6-P8bji/pub?gid=1984389436&single=true&output=csv";

const WEEKLY_CSV =
"https://docs.google.com/spreadsheets/d/e/2PACX-1vTDtYk0GQ5RzrRT_SBmcjH1TfE3k_kHJ5Sd7nmnoKr81UiDPHXF42gd46qCAuAW5hpwjdKC-6-P8bji/pub?gid=0&single=true&output=csv";

const COLORS={
  "Leeah":"#facc15",
  "Marissa":"#f472b6",
  "Chakri":"#fb923c",
  "Nitya":"#3b82f6"
};

let view="month";
let weeklyData=[];

/* ================= HELPERS ================= */
function pct(a,b){return b?Math.round(a/b*100):0;}

/* ================= CONFETTI (50% ONCE) ================= */
function celebrate(key){
  if(localStorage.getItem(key)) return;
  confetti({particleCount:160,spread:90,origin:{y:.6}});
  localStorage.setItem(key,"done");
}

/* ================= VIEW ================= */
function setView(v){view=v;loadData();}

/* ================= LOAD DATA ================= */
function loadData(){
  Promise.all([
    fetch(YEARLY_CSV).then(r=>r.text()),
    fetch(WEEKLY_CSV).then(r=>r.text())
  ]).then(([y,w])=>{

    weeklyData=w.trim().split("\n").slice(1).map(r=>{
      const c=r.split(",");
      return{
        date:new Date(c[0]),
        name:c[1].trim(),
        value:+c[2]||0
      };
    });

    const people=y.trim().split("\n").slice(1).map(r=>{
      const c=r.split(",");
      return{
        name:c[0].trim(),
        goal:+c[1]||0,
        ytd:+c[2]||0,
        total:0
      };
    });

    const now=new Date();

    people.forEach(p=>{
      if(view==="ytd"){p.total=p.ytd;return;}
      weeklyData.forEach(r=>{
        if(r.name!==p.name) return;
        const diff=(now-r.date)/86400000;
        if(view==="week"&&diff>=0&&diff<=7) p.total+=r.value;
        if(view==="month" &&
           r.date.getMonth()===now.getMonth() &&
           r.date.getFullYear()===now.getFullYear())
           p.total+=r.value;
      });
    });

    render(people);
  });
}

/* ================= RENDER ================= */
function render(people){
  const dash=document.getElementById("dashboard");
  dash.innerHTML="";

  const teamTotal=people.reduce((a,b)=>a+b.total,0);
  const teamPct=pct(teamTotal,TEAM_GOAL);
  if(teamPct>=50) celebrate("team-halfway");

  document.getElementById("team").innerHTML=`
    <div class="card" style="border:4px solid red">
      <h2>üèÅ Team Progress</h2>
      <div class="progress">
        <div class="bar" style="width:${teamPct}%"></div>
      </div>
      <p>${teamTotal} / ${TEAM_GOAL} (${teamPct}%)</p>
    </div>
  `;

  people.sort((a,b)=>pct(b.total,b.goal)-pct(a.total,a.goal));

  const mvp=people[0];
  document.getElementById("mvp").innerHTML=`
    üèÜ MVP (${view.toUpperCase()})<br>
    <strong>${mvp.name}</strong>
    ${mvp.total} enrollments
  `;

  people.forEach(p=>{
    const pPct=pct(p.total,p.goal);
    if(pPct>=50) celebrate(`half-${p.name}`);

    dash.innerHTML+=`
      <div class="card" onclick="showPopup('${p.name}')">
        <h2>${p.name}</h2>
        <div class="progress">
          <div class="bar" style="width:${pPct}%;background:${COLORS[p.name]}"></div>
        </div>
        <p>${p.total} / ${p.goal} (${pPct}%)</p>
      </div>
    `;
  });
}

/* ================= POPUP ================= */
function showPopup(name){
  let rows="",total=0;
  const now=new Date();
  weeklyData.forEach(r=>{
    if(r.name===name &&
       r.date.getMonth()===now.getMonth()){
      total+=r.value;
      rows+=`<p>${r.date.toLocaleDateString()}: ${r.value}</p>`;
    }
  });

  document.getElementById("popupContent").innerHTML=`
    <h2>${name} ‚Äì Monthly Breakdown</h2>
    ${rows||"<p>No activity yet</p>"}
    <hr><strong>Total this month: ${total}</strong>
  `;
  document.getElementById("popup").style.display="flex";
}

function closePopup(){
  document.getElementById("popup").style.display="none";
}

loadData();
</script>

</body>
</html>
