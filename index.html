<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Enrollment Race to 550</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
html,body{
  margin:0;
  font-family:Arial, sans-serif;
  overflow-x:hidden;
}

/* BACKGROUND */
body{
  padding:90px 20px 80px;
  text-align:center;
  background:repeating-linear-gradient(
    90deg,
    #86efac 0 60px,
    #a7f3d0 60px 120px
  );
}

/* CHECKER LINE */
body::before{
  content:"";
  position:fixed;
  top:0;left:0;
  width:100%;
  height:26px;
  background:repeating-linear-gradient(
    90deg,#000 0 20px,#fff 20px 40px
  );
  z-index:10;
}

/* TITLE */
h1{
  color:#ef4444;
  font-size:40px;
  margin-bottom:12px;
}

/* BUTTONS */
.buttons button{
  margin:6px;
  padding:8px 16px;
  border-radius:18px;
  border:none;
  cursor:pointer;
  font-weight:bold;
}
.buttons .active{
  background:#22c55e;
  color:white;
}

/* TOP ROW */
#topRow{
  display:grid;
  grid-template-columns:240px 420px 240px;
  gap:18px;
  justify-content:center;
  margin:30px auto 18px;
}

/* CARDS */
.card{
  background:white;
  padding:18px;
  border-radius:26px;
  box-shadow:0 10px 26px rgba(0,0,0,.15);
}
.mvp{border:4px solid #f59e0b}
.teamGoal{border:4px solid #ef4444}
.podium{border:4px solid silver}

/* PROGRESS */
.progress{
  background:#e5e7eb;
  height:16px;
  border-radius:12px;
  overflow:hidden;
  margin:10px 0;
}
.bar{
  height:100%;
  background:linear-gradient(90deg,#facc15,#22c55e);
  transition:width .4s ease;
}

/* TEAM ROW */
#teamGrid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:18px;
  max-width:1100px;
  margin:22px auto;
}

/* MANAGERS */
#managersTitle{
  margin:22px 0 12px;
  font-size:20px;
  color:#2563eb;
  font-weight:bold;
}
#managers{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:18px;
  max-width:760px;
  margin:0 auto;
}
.manager{border:3px solid #2563eb}

/* LAP */
#lap{
  position:fixed;
  bottom:18px;
  left:50%;
  transform:translateX(-50%);
  background:white;
  padding:8px 16px;
  border-radius:18px;
  font-weight:bold;
}
</style>
</head>

<body>

<h1>üèÅ Enrollment Race to 550</h1>

<div class="buttons">
  <button onclick="setView('ytd',this)">Year to Date</button>
  <button class="active" onclick="setView('month',this)">This Month</button>
  <button onclick="setView('week',this)">This Week</button>
</div>

<div id="topRow">
  <div id="mvp" class="card mvp"></div>
  <div id="teamGoal" class="card teamGoal"></div>
  <div id="podium" class="card podium"></div>
</div>

<div id="teamGrid"></div>

<div id="managersTitle">‚≠ê Managers</div>
<div id="managers"></div>

<div id="lap"></div>

<script>
/* ===== CONFIG ===== */
const TEAM_GOAL = 550;
const MANAGERS = ["Sabrina","Edward","Teresita"];

const YEARLY_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTDtYk0GQ5RzrRT_SBmcjH1TfE3k_kHJ5Sd7nmnoKr81UiDPHXF42gd46qCAuAW5hpwjdKC-6-P8bji/pub?gid=1984389436&single=true&output=csv";
const WEEKLY_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vTDtYk0GQ5RzrRT_SBmcjH1TfE3k_kHJ5Sd7nmnoKr81UiDPHXF42gd46qCAuAW5hpwjdKC-6-P8bji/pub?gid=0&single=true&output=csv";

let view="month";

/* ===== VIEW SWITCH ===== */
function setView(v,btn){
  view=v;
  document.querySelectorAll(".buttons button")
    .forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
  load();
}

/* ===== LOAD ===== */
function load(){
Promise.all([
  fetch(YEARLY_CSV+"&t="+Date.now()).then(r=>r.text()),
  fetch(WEEKLY_CSV+"&t="+Date.now()).then(r=>r.text())
]).then(([y,w])=>{

const weekly=w.trim().split("\n").slice(1).map(r=>{
  const c=r.split(",");
  return{d:new Date(c[0]),n:c[2].trim(),v:+c[4]||0};
});

const people=y.trim().split("\n").slice(1).map(r=>{
  const c=r.split(",");
  return{name:c[0],goal:+c[1],ytd:+c[2],total:0};
});

const now=new Date();
const sow=new Date(now);sow.setDate(now.getDate()-now.getDay());

people.forEach(p=>{
  if(view==="ytd"){p.total=p.ytd;return;}
  weekly.forEach(r=>{
    if(r.n!==p.name)return;
    if(view==="week" && r.d>=sow)p.total+=r.v;
    if(view==="month" && r.d.getMonth()===now.getMonth())p.total+=r.v;
  });
});

render(people);
});
}

/* ===== RENDER ===== */
function render(p){
p.sort((a,b)=>b.total-a.total);

const leader=p[0];
const team=p.filter(x=>!MANAGERS.includes(x.name));
const managers=p.filter(x=>MANAGERS.includes(x.name));

const teamTotal=team.reduce((a,b)=>a+b.total,0);
const pct=v=>Math.round(v/TEAM_GOAL*100);

/* MVP */
document.getElementById("mvp").innerHTML=
`üèÜ MVP<br><strong>${leader.name}</strong><br>${leader.total}`;

/* TEAM GOAL */
document.getElementById("teamGoal").innerHTML=`
<h3>üèÅ Team Goal</h3>
<div class="progress">
  <div class="bar" style="width:${pct(teamTotal)}%"></div>
</div>
${teamTotal} / ${TEAM_GOAL} (${pct(teamTotal)}%)
`;

/* PODIUM */
document.getElementById("podium").innerHTML=
"<h3>üèÅ Podium</h3>"+
team.slice(0,3).map((x,i)=>`
<div>${["ü•á","ü•à","ü•â"][i]} ${x.name} ${x.total}</div>`).join("");

/* TEAM */
document.getElementById("teamGrid").innerHTML=
team.map(x=>`
<div class="card">
<strong>${x.name}</strong>
<div class="progress"><div class="bar" style="width:${Math.round(x.total/x.goal*100)}%"></div></div>
${x.total} / ${x.goal}
</div>`).join("");

/* MANAGERS */
document.getElementById("managers").innerHTML=
managers.map(x=>`
<div class="card manager">
<strong>${x.name}</strong>
<div class="progress"><div class="bar" style="width:${Math.round(x.total/x.goal*100)}%"></div></div>
${x.total} / ${x.goal}
</div>`).join("");

/* LAP */
document.getElementById("lap").innerText=
teamTotal>=550?"üèÅ Finished":
teamTotal>=275?"Lap 3":
teamTotal>=140?"Lap 2":"Lap 1";
}

load();
</script>

</body>
</html>
